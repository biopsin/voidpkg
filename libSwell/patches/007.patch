From 577bd7f5c9080093a672bd9b64f7d989ef68a0da Mon Sep 17 00:00:00 2001
From: Marcus Gursch <marcus.gursch@rub.de>
Date: Wed, 5 May 2021 16:31:37 +0200
Subject: [PATCH] swell menubar: add margin to selected item background

---
 WDL/swell/swell-wnd-generic.cpp | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/WDL/swell/swell-wnd-generic.cpp b/WDL/swell/swell-wnd-generic.cpp
index 5b2d4e96..a20a9fd8 100644
--- a/WDL/swell/swell-wnd-generic.cpp
+++ b/WDL/swell/swell-wnd-generic.cpp
@@ -7008,7 +7008,7 @@ static int menuBarHitTest(HWND hwnd, int mousex, int mousey, RECT *rOut, int for
   {
     HDC dc = GetWindowDC(hwnd);
 
-    int x,xpos=r.left + g_swell_ctheme.menubar_margin_width;
+    int x,xpos=r.left;
     HMENU__ *menu = (HMENU__*)hwnd->m_menu;
     HGDIOBJ oldfont = dc ? SelectObject(dc,menubar_font) : NULL;
     const int n=menu->items.GetSize();
@@ -7205,8 +7205,12 @@ LRESULT DefWindowProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
               cr.bottom = r.bottom;
               if (!dis && menu->sel_vis == x)
               {
+                RECT crb = {0};
+                crb.left = cr.left, crb.right=cr.right, crb.top=cr.top, crb.bottom=cr.bottom;
+                crb.left = crb.left - g_swell_ctheme.menubar_margin_width;
+                crb.right = crb.right + g_swell_ctheme.menubar_margin_width;
                 HBRUSH br = CreateSolidBrush(g_swell_ctheme.menubar_bg_sel);
-                FillRect(dc,&cr,br);
+                FillRect(dc,&crb,br);
                 DeleteObject(br);
                 SetTextColor(dc,g_swell_ctheme.menubar_text_sel);
               }
